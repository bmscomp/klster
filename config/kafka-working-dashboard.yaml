apiVersion: v1
kind: ConfigMap
metadata:
  name: kafka-working-dashboard
  namespace: monitoring
  labels:
    grafana_dashboard: "1"
data:
  kafka-working.json: |
    {
      "annotations": {"list": []},
      "editable": true,
      "id": null,
      "panels": [
        {
          "datasource": "Prometheus",
          "fieldConfig": {
            "defaults": {
              "color": {"mode": "thresholds"},
              "mappings": [],
              "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]},
              "unit": "short"
            }
          },
          "gridPos": {"h": 6, "w": 8, "x": 0, "y": 0},
          "id": 1,
          "options": {
            "showThresholdLabels": false,
            "showThresholdMarkers": true
          },
          "targets": [
            {
              "expr": "kafka_controller_kafkacontroller_activebrokercount",
              "refId": "A"
            }
          ],
          "title": "Active Brokers",
          "type": "gauge"
        },
        {
          "datasource": "Prometheus",
          "fieldConfig": {
            "defaults": {
              "color": {"mode": "thresholds"},
              "mappings": [],
              "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}
            }
          },
          "gridPos": {"h": 6, "w": 8, "x": 8, "y": 0},
          "id": 2,
          "options": {
            "showThresholdLabels": false,
            "showThresholdMarkers": true
          },
          "targets": [
            {
              "expr": "kafka_controller_kafkacontroller_globaltopiccount",
              "refId": "A"
            }
          ],
          "title": "Total Topics",
          "type": "gauge"
        },
        {
          "datasource": "Prometheus",
          "fieldConfig": {
            "defaults": {
              "color": {"mode": "thresholds"},
              "mappings": [],
              "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}
            }
          },
          "gridPos": {"h": 6, "w": 8, "x": 16, "y": 0},
          "id": 3,
          "options": {
            "showThresholdLabels": false,
            "showThresholdMarkers": true
          },
          "targets": [
            {
              "expr": "kafka_controller_kafkacontroller_globalpartitioncount",
              "refId": "A"
            }
          ],
          "title": "Total Partitions",
          "type": "gauge"
        },
        {
          "datasource": "Prometheus",
          "fieldConfig": {
            "defaults": {
              "color": {"mode": "palette-classic"},
              "custom": {
                "axisPlacement": "auto",
                "drawStyle": "line",
                "fillOpacity": 10,
                "lineWidth": 2,
                "showPoints": "never"
              },
              "mappings": [],
              "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]},
              "unit": "bytes"
            }
          },
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 6},
          "id": 4,
          "options": {
            "legend": {"calcs": ["last"], "displayMode": "table", "placement": "bottom"},
            "tooltip": {"mode": "multi"}
          },
          "targets": [
            {
              "expr": "sum(kafka_log_log_size{topic=\"perf-test\"}) by (kubernetes_pod_name, zone)",
              "legendFormat": "{{kubernetes_pod_name}} ({{zone}})",
              "refId": "A"
            }
          ],
          "title": "Topic Size by Broker (perf-test)",
          "type": "timeseries"
        },
        {
          "datasource": "Prometheus",
          "fieldConfig": {
            "defaults": {
              "color": {"mode": "palette-classic"},
              "custom": {
                "axisPlacement": "auto",
                "drawStyle": "line",
                "fillOpacity": 10,
                "lineWidth": 1,
                "showPoints": "never"
              },
              "mappings": [],
              "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}
            }
          },
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 6},
          "id": 5,
          "options": {
            "legend": {"calcs": [], "displayMode": "list", "placement": "bottom"},
            "tooltip": {"mode": "multi"}
          },
          "targets": [
            {
              "expr": "kafka_log_log_logendoffset{topic=\"perf-test\"}",
              "legendFormat": "{{kubernetes_pod_name}} - p{{partition}}",
              "refId": "A"
            }
          ],
          "title": "Log End Offset per Partition (perf-test)",
          "type": "timeseries"
        },
        {
          "datasource": "Prometheus",
          "fieldConfig": {
            "defaults": {
              "color": {"mode": "palette-classic"},
              "custom": {
                "axisPlacement": "auto",
                "drawStyle": "line",
                "fillOpacity": 10,
                "lineWidth": 2,
                "showPoints": "never"
              },
              "mappings": [],
              "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]},
              "unit": "bytes"
            }
          },
          "gridPos": {"h": 8, "w": 24, "x": 0, "y": 14},
          "id": 6,
          "options": {
            "legend": {"calcs": ["last"], "displayMode": "table", "placement": "bottom"},
            "tooltip": {"mode": "multi"}
          },
          "targets": [
            {
              "expr": "java_lang_memory_heapmemoryusage_used",
              "legendFormat": "{{kubernetes_pod_name}} ({{zone}})",
              "refId": "A"
            }
          ],
          "title": "JVM Heap Memory Used by Broker",
          "type": "timeseries"
        },
        {
          "datasource": "Prometheus",
          "fieldConfig": {
            "defaults": {
              "color": {"mode": "thresholds"},
              "custom": {
                "align": "auto",
                "cellOptions": {"type": "auto"},
                "inspect": false
              },
              "mappings": [],
              "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}
            }
          },
          "gridPos": {"h": 8, "w": 24, "x": 0, "y": 22},
          "id": 7,
          "options": {
            "showHeader": true
          },
          "targets": [
            {
              "expr": "kafka_log_log_size",
              "format": "table",
              "instant": true,
              "refId": "A"
            }
          ],
          "title": "All Topics and Partitions",
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {
                  "Time": true,
                  "__name__": true,
                  "app_kubernetes_io_instance": true,
                  "app_kubernetes_io_managed_by": true,
                  "app_kubernetes_io_name": true,
                  "app_kubernetes_io_part_of": true,
                  "container": true,
                  "endpoint": true,
                  "instance": true,
                  "job": true,
                  "kubernetes_namespace": true,
                  "kubernetes_node_name": true,
                  "namespace": true,
                  "pod": true,
                  "strimzi_io_broker_role": true,
                  "strimzi_io_cluster": true,
                  "strimzi_io_component_type": true,
                  "strimzi_io_controller": true,
                  "strimzi_io_controller_name": true,
                  "strimzi_io_controller_role": true,
                  "strimzi_io_kind": true,
                  "strimzi_io_name": true,
                  "strimzi_io_pod_name": true,
                  "strimzi_io_pool_name": true
                },
                "renameByName": {
                  "Value": "Size (bytes)",
                  "kubernetes_pod_name": "Broker",
                  "partition": "Partition",
                  "topic": "Topic",
                  "zone": "Zone"
                }
              }
            }
          ],
          "type": "table"
        }
      ],
      "refresh": "10s",
      "schemaVersion": 27,
      "style": "dark",
      "tags": ["kafka", "working"],
      "templating": {"list": []},
      "time": {"from": "now-15m", "to": "now"},
      "timezone": "",
      "title": "Kafka Cluster Metrics (Working)",
      "uid": "kafka-working",
      "version": 1
    }

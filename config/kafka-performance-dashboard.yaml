apiVersion: v1
kind: ConfigMap
metadata:
  name: kafka-performance-dashboard
  namespace: monitoring
  labels:
    grafana_dashboard: "1"
data:
  kafka-performance.json: |
    {
      "annotations": {"list": []},
      "editable": true,
      "gnetId": null,
      "graphTooltip": 0,
      "id": null,
      "links": [],
      "panels": [
        {
          "datasource": "Prometheus",
          "fieldConfig": {
            "defaults": {
              "color": {"mode": "palette-classic"},
              "custom": {"axisLabel": "Messages", "axisPlacement": "auto", "drawStyle": "line", "fillOpacity": 10, "lineWidth": 2, "showPoints": "never"},
              "unit": "short"
            }
          },
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 0},
          "id": 1,
          "options": {"legend": {"calcs": ["last"], "displayMode": "table", "placement": "bottom"}, "tooltip": {"mode": "multi"}},
          "targets": [
            {
              "expr": "kafka_log_log_logendoffset{topic='perf-test'}",
              "legendFormat": "{{kubernetes_pod_name}} - p{{partition}} ({{zone}})",
              "refId": "A"
            }
          ],
          "title": "Log End Offset (Messages) - perf-test",
          "type": "timeseries"
        },
        {
          "datasource": "Prometheus",
          "fieldConfig": {
            "defaults": {
              "color": {"mode": "palette-classic"},
              "custom": {"axisLabel": "Bytes", "axisPlacement": "auto", "drawStyle": "line", "fillOpacity": 10, "lineWidth": 2, "showPoints": "never"},
              "unit": "bytes"
            }
          },
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 0},
          "id": 2,
          "options": {"legend": {"calcs": ["last"], "displayMode": "table", " placement": "bottom"}, "tooltip": {"mode": "multi"}},
          "targets": [
            {
              "expr": "kafka_log_log_size{topic='perf-test'}",
              "legendFormat": "{{kubernetes_pod_name}} - p{{partition}} ({{zone}})",
              "refId": "A"
            }
          ],
          "title": "Topic Size (Bytes) - perf-test",
          "type": "timeseries"
        },
        {
          "datasource": "Prometheus",
          "fieldConfig": {
            "defaults": {
              "color": {"mode": "palette-classic"},
              "custom": {"axisPlacement": "auto", "drawStyle": "line", "fillOpacity": 10, "lineWidth": 2, "showPoints": "never"},
              "unit": "short"
            }
          },
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 8},
          "id": 3,
          "options": {"legend": {"calcs": [], "displayMode": "list", "placement": "bottom"}, "tooltip": {"mode": "multi"}},
          "targets": [
            {
              "expr": "kafka_controller_kafkacontroller_globalpartitioncount",
              "legendFormat": "Total Partitions",
              "refId": "A"
            }
          ],
          "title": "Global Partition Count",
          "type": "timeseries"
        },
        {
          "datasource": "Prometheus",
          "fieldConfig": {
            "defaults": {
              "color": {"mode": "palette-classic"},
              "custom": {"axisPlacement": "auto", "drawStyle": "line", "fillOpacity": 10, "lineWidth": 2, "showPoints": "never"},
              "unit": "short"
            }
          },
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 8},
          "id": 4,
          "options": {"legend": {"calcs": [], "displayMode": "list", "placement": "bottom"}, "tooltip": {"mode": "multi"}},
          "targets": [
            {
              "expr": "kafka_controller_kafkacontroller_activebrokercount",
              "legendFormat": "Active Brokers",
              "refId": "A"
            }
          ],
          "title": "Active Broker Count",
          "type": "timeseries"
        },
        {
          "datasource": "Prometheus",
          "fieldConfig": {
            "defaults": {
              "color": {"mode": "palette-classic"},
              "custom": {"axisLabel": "Collections/sec", "axisPlacement": "auto", "drawStyle": "line", "fillOpacity": 10, "lineWidth": 1, "showPoints": "never"}
            }
          },
          "gridPos": {"h": 8, "w": 24, "x": 0, "y": 16},
          "id": 5,
          "options": {"legend": {"calcs": [], "displayMode": "list", "placement": "bottom"}, "tooltip": {"mode": "multi"}},
          "targets": [
            {
              "expr": "rate(java_lang_garbagecollector_collectioncount[1m])",
              "legendFormat": "{{name}} - {{kubernetes_pod_name}}",
              "refId": "A"
            }
          ],
          "title": "JVM Garbage Collection Rate",
          "type": "timeseries"
        }
      ],
      "refresh": "5s",
      "schemaVersion": 27,
      "style": "dark",
      "tags": ["kafka", "performance"],
      "templating": {"list": []},
      "time": {"from": "now-15m", "to": "now"},
      "timepicker": {},
      "timezone": "",
      "title": "Kafka Performance Metrics",
      "uid": "kafka-performance",
      "version": 1
    }
